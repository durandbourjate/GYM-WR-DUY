<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ãœbungspools | Wirtschaft und Recht | Gymnasium Hofwil</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Mono:wght@400;500&display=swap');
:root{
  --c-bg:#f0f2f5;--c-surface:#fff;--c-text:#1e293b;--c-text-soft:#64748b;
  --c-border:#e2e8f0;--radius:10px;
  --c-vwl:#f89907;--c-vwl-light:#ffb74d;--c-vwl-bg:#fff8eb;
  --c-bwl:#01a9f4;--c-bwl-light:#4fc3f7;--c-bwl-bg:#e8f7fe;
  --c-recht:#73ab2c;--c-recht-light:#8bc34a;--c-recht-bg:#f1f8e8;
  --shadow-sm:0 1px 3px rgba(0,0,0,.06);
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',system-ui,sans-serif;background:var(--c-bg);color:var(--c-text);line-height:1.6;min-height:100vh}
.header{background:linear-gradient(135deg,#1e293b,#334155);color:#fff;padding:28px 24px;text-align:center;display:flex;align-items:center;gap:16px}
.header h1{font-size:1.5rem;font-weight:700;letter-spacing:-.02em}
.header .sub{font-size:.85rem;opacity:.7;margin-top:4px}
.container{max-width:800px;margin:0 auto;padding:24px 16px 80px}

/* â”€â”€ Fachbereich-Sektionen (klappbar) â”€â”€ */
.fach-section{margin-bottom:20px;border-radius:var(--radius);overflow:hidden;background:var(--c-surface);box-shadow:var(--shadow-sm);border:1px solid var(--c-border)}
.fach-header{display:flex;align-items:center;gap:12px;padding:16px 20px;cursor:pointer;user-select:none;transition:background .15s}
.fach-header:hover{background:color-mix(in srgb,var(--c-bg) 50%,transparent)}
.fach-header .fach-dot{width:14px;height:14px;border-radius:50%;flex-shrink:0}
.fach-header h2{font-size:1.1rem;font-weight:700}
.fach-header .fach-info{display:flex;align-items:center;gap:10px;margin-left:auto;flex-shrink:0}
.fach-header .fach-count{font-size:.78rem;color:var(--c-text-soft);font-weight:500}
.fach-header .fach-questions{font-family:'DM Mono',monospace;font-size:.72rem;font-weight:600;padding:3px 9px;border-radius:10px;background:var(--c-bg);color:var(--c-text-soft)}
.fach-header .chevron{width:20px;height:20px;display:flex;align-items:center;justify-content:center;color:var(--c-text-soft);transition:transform .25s ease;flex-shrink:0}
.fach-section.open .chevron{transform:rotate(180deg)}
.fach-all-btn{display:inline-flex;align-items:center;gap:5px;padding:5px 14px;border-radius:16px;font-size:.75rem;font-weight:600;text-decoration:none;border:1.5px solid;transition:.2s;white-space:nowrap;flex-shrink:0}
.fach-all-btn:hover{color:#fff!important}
.fach-all-btn.fach-all-vwl{color:var(--c-vwl);border-color:var(--c-vwl)}.fach-all-btn.fach-all-vwl:hover{background:var(--c-vwl)}
.fach-all-btn.fach-all-bwl{color:var(--c-bwl);border-color:var(--c-bwl)}.fach-all-btn.fach-all-bwl:hover{background:var(--c-bwl)}
.fach-all-btn.fach-all-recht{color:var(--c-recht);border-color:var(--c-recht)}.fach-all-btn.fach-all-recht:hover{background:var(--c-recht)}

/* Klappbarer Inhalt */
.fach-body{overflow:hidden;transition:max-height .3s ease,opacity .25s ease;max-height:0;opacity:0}
.fach-section.open .fach-body{opacity:1}
.fach-body-inner{padding:0 20px 20px}

/* Farbige Oberkante je Fachbereich */
.fach-section.fach-vwl{border-top:3px solid var(--c-vwl)}
.fach-section.fach-bwl{border-top:3px solid var(--c-bwl)}
.fach-section.fach-recht{border-top:3px solid var(--c-recht)}

/* Pool-Karten */
.pool-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
.pool-card{background:var(--c-surface);border:1px solid var(--c-border);border-radius:var(--radius);padding:16px;text-decoration:none;color:var(--c-text);transition:.2s;display:flex;flex-direction:column;box-shadow:var(--shadow-sm)}
.pool-card:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.1)}
.pool-card .pool-title{font-weight:700;font-size:.92rem;margin-bottom:5px}
.pool-card .pool-meta{font-size:.76rem;color:var(--c-text-soft);margin-bottom:8px}
.pool-card .pool-stats{display:flex;gap:6px;flex-wrap:wrap}
.pool-card .stat{font-size:.68rem;font-weight:600;padding:3px 8px;border-radius:10px;background:var(--c-bg)}
.pool-card.vwl{border-left:4px solid var(--c-vwl)}
.pool-card.vwl:hover{border-color:var(--c-vwl);background:var(--c-vwl-bg)}
.pool-card.bwl{border-left:4px solid var(--c-bwl)}
.pool-card.bwl:hover{border-color:var(--c-bwl);background:var(--c-bwl-bg)}
.pool-card.recht{border-left:4px solid var(--c-recht)}
.pool-card.recht:hover{border-color:var(--c-recht);background:var(--c-recht-bg)}
.empty-msg{font-size:.88rem;color:var(--c-text-soft);font-style:italic;padding:4px 0}
.pool-card{position:relative}
.pool-card .pool-title{padding-right:28px}
.card-lz-btn{position:absolute;top:14px;right:12px;width:24px;height:24px;border-radius:50%;background:none;border:none;font-size:.75rem;cursor:pointer;transition:.15s;display:none;align-items:center;justify-content:center;padding:0;line-height:1}
.card-lz-btn:hover{transform:scale(1.2)}
.card-lz-btn.visible{display:flex}
/* â•â•â• LERNZIELE â€” Modal fÃ¼r index.html â•â•â• */
.lz-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:500;display:none;align-items:center;justify-content:center;padding:20px;backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px)}
.lz-overlay.active{display:flex}
.lz-modal{background:var(--c-surface);border-radius:16px;max-width:600px;width:100%;max-height:80vh;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(0,0,0,.2);animation:lzSlideUp .25s ease}
@keyframes lzSlideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
.lz-modal-header{display:flex;align-items:center;justify-content:space-between;padding:20px 24px 16px;border-bottom:1px solid var(--c-border)}
.lz-modal-header h2{font-size:1.1rem;font-weight:700;display:flex;align-items:center;gap:8px}
.lz-modal-close{background:none;border:none;font-size:1.3rem;cursor:pointer;color:var(--c-text-soft);padding:4px 8px;border-radius:6px;transition:.15s;line-height:1}
.lz-modal-close:hover{background:var(--c-border);color:var(--c-text)}
.lz-modal-body{overflow-y:auto;padding:20px 24px 24px;flex:1}
.lz-pool-section{margin-bottom:20px}
.lz-pool-section h3,.lz-topic-section h3{font-size:.85rem;font-weight:600;color:var(--c-text-soft);text-transform:uppercase;letter-spacing:.04em;margin-bottom:10px}
.lz-topic-section{margin-top:16px}
.lz-topic{background:var(--c-bg);border-radius:var(--radius);margin-bottom:8px;overflow:hidden;border:1px solid var(--c-border)}
.lz-topic-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;cursor:pointer;transition:background .15s;gap:8px}
.lz-topic-header:hover{background:var(--c-border)}
.lz-topic-label{font-size:.9rem;font-weight:600;flex:1}
.lz-topic-badge{font-family:'DM Mono',monospace;font-size:.72rem;padding:2px 8px;border-radius:99px;white-space:nowrap;background:var(--c-bg);border:1px solid var(--c-border)}
.lz-topic-chevron{font-size:.75rem;color:var(--c-text-soft);transition:transform .2s}
.lz-topic.open .lz-topic-chevron{transform:rotate(90deg)}
.lz-topic-body{max-height:0;overflow:hidden;transition:max-height .25s ease}
.lz-topic.open .lz-topic-body{max-height:500px}
.lz-topic-body .lz-list{padding:0 16px 12px}
.lz-list{list-style:none;padding:0}
.lz-list li{position:relative;padding:7px 0 7px 22px;font-size:.88rem;line-height:1.5;border-bottom:1px solid var(--c-border)}
.lz-list li:last-child{border-bottom:none}
.lz-list li::before{content:'ğŸ';position:absolute;left:0;top:7px;font-size:.72rem}
.lz-tax{font-family:'DM Mono',monospace;font-size:.68rem;background:var(--c-border);color:var(--c-text-soft);padding:1px 6px;border-radius:4px;margin-left:4px;white-space:nowrap}
.footer{text-align:center;padding:20px;font-size:.75rem;color:var(--c-text-soft)}

/* â”€â”€ Dark Mode â”€â”€ */
html.dark{--c-bg:#0f1117;--c-surface:#1a1d27;--c-text:#e2e8f0;--c-text-soft:#94a3b8;--c-border:#2d3348;
  --c-vwl-bg:#2a1f0a;--c-bwl-bg:#0a1f2a;--c-recht-bg:#1a2a0a}
html.dark .header{background:linear-gradient(135deg,#0f1117,#1a1d27)}
html.dark .pool-card .stat,html.dark .fach-header .fach-questions{background:var(--c-border)}
html.dark .fach-header:hover{background:color-mix(in srgb,var(--c-border) 40%,transparent)}
/* â”€â”€ Theme Toggle â”€â”€ */
.theme-toggle{display:flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:8px;background:rgba(255,255,255,.15);border:none;color:#fff;font-size:1.15rem;cursor:pointer;flex-shrink:0;transition:.15s;padding:0;line-height:1}
.theme-toggle:hover{background:rgba(255,255,255,.3)}
@media(max-width:500px){
  .pool-grid{grid-template-columns:1fr}
  .container{padding:16px 12px 60px}
  .fach-header{padding:14px 16px}
  .fach-body-inner{padding:0 16px 16px}
}
</style>
<script>
(function(){
  var saved=localStorage.getItem('pool-theme');
  var isDark=saved==='dark'||(saved===null&&window.matchMedia('(prefers-color-scheme:dark)').matches);
  if(isDark)document.documentElement.classList.add('dark');
})();
</script>
</head>
<body>

<div class="header">
<div style="flex:1"></div>
<div>
<h1>ğŸ“š Ãœbungspools</h1>
<div class="sub">Wirtschaft und Recht Â· Gymnasium Hofwil</div>
</div>
<div style="flex:1;display:flex;justify-content:flex-end;gap:8px">
<button class="theme-toggle" id="headerLzBtn" onclick="openAllLernziele()" title="Alle Lernziele" aria-label="Alle Lernziele anzeigen" style="display:none">ğŸ</button>
<button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Light/Dark Mode wechseln" aria-label="Farbmodus wechseln">ğŸŒ™</button>
</div>
</div>

<div class="container" id="content">
<div style="text-align:center;padding:40px;color:var(--c-text-soft)">Wird geladenâ€¦</div>
</div>

<div class="footer">Gymnasium Hofwil Â· Wirtschaft und Recht</div>

<!-- LERNZIELE â€” Modal -->
<div class="lz-overlay" id="lzOverlay" onclick="if(event.target===this)closeLzModal()">
  <div class="lz-modal">
    <div class="lz-modal-header">
      <h2 id="lzModalTitle">ğŸ Lernziele</h2>
      <button class="lz-modal-close" onclick="closeLzModal()">&times;</button>
    </div>
    <div class="lz-modal-body" id="lzModalBody"></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THEME TOGGLE â€” Light/Dark Mode
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleTheme(){
  var html=document.documentElement;
  var isDark=html.classList.toggle('dark');
  localStorage.setItem('pool-theme',isDark?'dark':'light');
  updateThemeIcon();
}
function updateThemeIcon(){
  var btn=document.getElementById('themeToggle');
  if(btn)btn.textContent=document.documentElement.classList.contains('dark')?'â˜€ï¸':'ğŸŒ™';
}
updateThemeIcon();
window.matchMedia('(prefers-color-scheme:dark)').addEventListener('change',function(e){
  if(localStorage.getItem('pool-theme'))return;
  document.documentElement.classList.toggle('dark',e.matches);
  updateThemeIcon();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// POOL REGISTRY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Add new pools here. The index page reads this to display all available pools.
const POOLS = [
  {
    id: "vwl_beduerfnisse",
    fach: "VWL",
    title: "BedÃ¼rfnisse, Knappheit & Produktionsfaktoren",
    meta: "SF GYM1",
    questions: 70,
    topics: 7
  },
  {
    id: "vwl_menschenbild",
    fach: "VWL",
    title: "Ã–konomisches Menschenbild",
    meta: "SF GYM1",
    questions: 66,
    topics: 7
  },
  {
    id: "vwl_bip",
    fach: "VWL",
    title: "Bruttoinlandprodukt (BIP)",
    meta: "EWR GYM2",
    questions: 78,
    topics: 7
  },
  {
    id: "vwl_wachstum",
    fach: "VWL",
    title: "Wirtschaftswachstum â€“ TriebkrÃ¤fte und Effekte",
    meta: "SF GYM1â€“GYM4",
    questions: 76,
    topics: 6
  },
  {
    id: "vwl_steuern",
    fach: "VWL",
    title: "Steuern und Staatseinnahmen",
    meta: "SF GYM3",
    questions: 85,
    topics: 6
  },
  {
    id: "vwl_arbeitslosigkeit",
    fach: "VWL",
    title: "Arbeitslosigkeit & Armut",
    meta: "SF GYM3",
    questions: 74,
    topics: 7
  },
  {
    id: "vwl_staatsverschuldung",
    fach: "VWL",
    title: "Staatsverschuldung",
    meta: "SF GYM3",
    questions: 87,
    topics: 7
  },
  {
    id: "vwl_sozialpolitik",
    fach: "VWL",
    title: "Sozialpolitik und Sozialversicherungen",
    meta: "SF GYM3",
    questions: 105,
    topics: 7
  },
  {
    id: "vwl_markteffizienz",
    fach: "VWL",
    title: "Markteffizienz",
    meta: "SF GYM2/GYM3",
    questions: 162,
    topics: 13
  },
  {
    id: "vwl_geld",
    fach: "VWL",
    title: "Geld, Geldpolitik und FinanzmÃ¤rkte",
    meta: "SF GYM3â€“GYM4",
    questions: 100,
    topics: 13
  },
  // â”€â”€ BWL â”€â”€
  {
    id: "bwl_einfuehrung",
    fach: "BWL",
    title: "EinfÃ¼hrung BWL â€“ Grundlagen der Betriebswirtschaftslehre",
    meta: "SF GYM1",
    questions: 68,
    topics: 7
  },
  {
    id: "bwl_marketing",
    fach: "BWL",
    title: "Markt- und Leistungsanalyse",
    meta: "SF GYM3",
    questions: 63,
    topics: 6
  },
  {
    id: "bwl_stratfuehrung",
    fach: "BWL",
    title: "Strategische UnternehmensfÃ¼hrung",
    meta: "SF GYM1",
    questions: 65,
    topics: 7
  },
  {
    id: "bwl_unternehmensmodell",
    fach: "BWL",
    title: "Unternehmensmodell â€“ UmweltsphÃ¤ren & Anspruchsgruppen",
    meta: "SF GYM1",
    questions: 71,
    topics: 7
  },
  // â”€â”€ Recht â”€â”€
  {
    id: "recht_einfuehrung",
    fach: "Recht",
    title: "EinfÃ¼hrung Recht â€“ GrundsÃ¤tze der Rechtsordnung",
    meta: "SF GYM1â€“GYM2",
    questions: 56,
    topics: 5
  },
  {
    id: "recht_einleitungsartikel",
    fach: "Recht",
    title: "Rechtsquellen und RechtsgrundsÃ¤tze â€“ ZGB Einleitungsartikel",
    meta: "SF GYM1â€“GYM2",
    questions: 56,
    topics: 6
  },
  {
    id: "recht_personenrecht",
    fach: "Recht",
    title: "Personenrecht â€“ ZGB 11 bis 28",
    meta: "SF GYM2",
    questions: 52,
    topics: 5
  },
  {
    id: "recht_sachenrecht",
    fach: "Recht",
    title: "Sachenrecht â€“ Eigentum, Besitz und dingliche Rechte",
    meta: "SF GYM2",
    questions: 69,
    topics: 7
  },
  {
    id: "recht_mietrecht",
    fach: "Recht",
    title: "Mietrecht â€“ OR 253 bis 274",
    meta: "SF GYM3",
    questions: 80,
    topics: 7
  },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const FACH_ORDER = ["VWL", "BWL", "Recht"];
const FACH_COLORS = { VWL: "vwl", BWL: "bwl", Recht: "recht" };
const FACH_DOT_COLORS = { VWL: "#f89907", BWL: "#01a9f4", Recht: "#73ab2c" };
const CHEVRON_SVG = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';

function render() {
  const container = document.getElementById('content');
  let html = '';

  FACH_ORDER.forEach(fach => {
    const pools = POOLS.filter(p => p.fach === fach);
    const colorClass = FACH_COLORS[fach];
    const dotColor = FACH_DOT_COLORS[fach];
    const totalQ = pools.reduce((s, p) => s + p.questions, 0);
    // Fachbereiche mit Pools: offen. Leere: eingeklappt.
    const isOpen = pools.length > 0;

    html += '<div class="fach-section fach-' + colorClass + (isOpen ? ' open' : '') + '">';

    // â”€â”€ Klickbarer Header â”€â”€
    html += '<div class="fach-header" onclick="toggleSection(this)">';
    html += '<div class="fach-dot" style="background:' + dotColor + '"></div>';
    html += '<h2>' + fach + '</h2>';
    html += '<div class="fach-info">';
    html += '<span class="fach-count">' + pools.length + ' Pool' + (pools.length !== 1 ? 's' : '') + '</span>';
    if (totalQ > 0) {
      html += '<span class="fach-questions">' + totalQ + ' Fragen</span>';
    }
    if (pools.length > 1) {
      var allIds = pools.map(p => p.id).join(',');
      html += '<a href="pool.html?pools=' + allIds + '" class="fach-all-btn fach-all-' + colorClass + '" onclick="event.stopPropagation()" title="Alle ' + fach + '-Pools kombiniert Ã¼ben">Alle</a>';
    }
    html += '</div>';
    html += '<div class="chevron">' + CHEVRON_SVG + '</div>';
    html += '</div>';

    // â”€â”€ Klappbarer Inhalt â”€â”€
    html += '<div class="fach-body"><div class="fach-body-inner">';
    if (pools.length === 0) {
      html += '<div class="empty-msg">Noch keine Ãœbungspools vorhanden.</div>';
    } else {
      html += '<div class="pool-grid">';
      pools.forEach(p => {
        html += '<a class="pool-card ' + colorClass + '" href="pool.html?pool=' + p.id + '">';
        html += '<button class="card-lz-btn" data-pool="' + p.id + '" onclick="event.preventDefault();event.stopPropagation();loadPoolLernziele(\'' + p.id + '\',\'' + p.title + '\')" title="Lernziele">ğŸ</button>';
        html += '<div class="pool-title">' + p.title + '</div>';
        html += '<div class="pool-meta">' + p.meta + '</div>';
        html += '<div class="pool-stats">';
        html += '<span class="stat">' + p.questions + ' Fragen</span>';
        html += '<span class="stat">' + p.topics + ' Themen</span>';
        html += '</div>';
        html += '</a>';
      });
      html += '</div>';
    }
    html += '</div></div>';
    html += '</div>';
  });

  container.innerHTML = html;

  // Initiale HÃ¶he fÃ¼r offene Sektionen setzen
  document.querySelectorAll('.fach-section.open .fach-body').forEach(body => {
    body.style.maxHeight = body.scrollHeight + 'px';
  });
}

function toggleSection(headerEl) {
  const section = headerEl.closest('.fach-section');
  const body = section.querySelector('.fach-body');

  if (section.classList.contains('open')) {
    // Zuklappen: erst aktuelle HÃ¶he fixieren, dann auf 0
    body.style.maxHeight = body.scrollHeight + 'px';
    requestAnimationFrame(() => {
      body.style.maxHeight = '0';
      body.style.opacity = '0';
    });
    section.classList.remove('open');
  } else {
    // Aufklappen
    section.classList.add('open');
    body.style.maxHeight = body.scrollHeight + 'px';
    body.style.opacity = '1';
    // Nach der Animation: maxHeight entfernen (damit Inhalt dynamisch wachsen kann)
    body.addEventListener('transitionend', function handler() {
      if (section.classList.contains('open')) {
        body.style.maxHeight = 'none';
      }
      body.removeEventListener('transitionend', handler);
    });
  }
}

render();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LERNZIELE â€” Dynamisches Laden und Anzeige
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Cache fÃ¼r geladene Configs (vermeidet doppeltes Laden)
var lzCache = {};

// Nach dem Rendern: ğŸ-Buttons nur anzeigen, wenn Lernziele vorhanden
function checkLzButtons() {
  var anyLzFound = false;
  var headerBtn = document.getElementById('headerLzBtn');
  document.querySelectorAll('.card-lz-btn').forEach(function(btn) {
    var poolName = btn.dataset.pool;
    if (lzCache[poolName]) {
      if (lzCache[poolName].hasLZ) { btn.classList.add('visible'); anyLzFound = true; }
    } else {
      // Config asynchron laden und prÃ¼fen (cache-bust verhindert veraltete Versionen)
      fetch('config/' + poolName + '.js', {cache: 'no-cache'}).then(function(r) { return r.text(); }).then(function(code) {
        try {
          var w = {};
          var fn = new Function('window', code + '; return {POOL_META: window.POOL_META, TOPICS: window.TOPICS, QUESTIONS: window.QUESTIONS};');
          var data = fn(w);
          var hasLZ = false;
          if (data.POOL_META && data.POOL_META.lernziele && data.POOL_META.lernziele.length > 0) hasLZ = true;
          if (!hasLZ && data.TOPICS) {
            var keys = Object.keys(data.TOPICS);
            for (var i = 0; i < keys.length; i++) {
              var t = data.TOPICS[keys[i]];
              if (t && t.lernziele && t.lernziele.length > 0) { hasLZ = true; break; }
            }
          }
          lzCache[poolName] = { data: data, hasLZ: hasLZ };
          if (hasLZ) { btn.classList.add('visible'); if (headerBtn) headerBtn.style.display = ''; }
        } catch(e) { console.warn('Lernziele-Check fehlgeschlagen fÃ¼r ' + poolName, e); }
      }).catch(function(e) { console.warn('Config laden fehlgeschlagen fÃ¼r ' + poolName, e); });
    }
  });
  if (anyLzFound && headerBtn) headerBtn.style.display = '';
}

async function loadPoolLernziele(poolName, poolTitle) {
  try {
    var cached = lzCache[poolName];
    if (!cached) {
      var resp = await fetch('config/' + poolName + '.js', {cache: 'no-cache'});
      var code = await resp.text();
      var w = {};
      var fn = new Function('window', code + '; return {POOL_META: window.POOL_META, TOPICS: window.TOPICS, QUESTIONS: window.QUESTIONS};');
      cached = { data: fn(w), hasLZ: true };
      lzCache[poolName] = cached;
    }
    var data = cached.data;
    if (!data.POOL_META.lernziele && !Object.values(data.TOPICS).some(function(t) { return t.lernziele && t.lernziele.length; })) {
      return; // Kein Modal Ã¶ffnen wenn keine Lernziele
    }
    showPoolLernziele(data.POOL_META, data.TOPICS, data.QUESTIONS);
  } catch (e) {
    console.error('Lernziele laden fehlgeschlagen:', e);
  }
}

function showPoolLernziele(meta, topics, questions) {
  var title = meta.title || 'Lernziele';
  document.getElementById('lzModalTitle').innerHTML = 'ğŸ ' + title.replace(/^Ãœbungspool:\s*/i, '');
  var body = document.getElementById('lzModalBody');
  var html = '';
  if (meta.lernziele && meta.lernziele.length) {
    html += '<div class="lz-pool-section"><h3>Ãœbergeordnete Lernziele</h3><ul class="lz-list">';
    meta.lernziele.forEach(function(lz) { html += '<li>' + formatLZ(lz) + '</li>'; });
    html += '</ul></div>';
  }
  var keys = Object.keys(topics);
  var anyLZ = keys.some(function(k) { return topics[k].lernziele && topics[k].lernziele.length; });
  if (anyLZ) {
    html += '<div class="lz-topic-section"><h3>Lernziele pro Thema</h3>';
    keys.forEach(function(key) {
      var t = topics[key];
      if (!t.lernziele || !t.lernziele.length) return;
      var count = questions ? questions.filter(function(q) { return q.topic === key; }).length : 0;
      html += '<div class="lz-topic">';
      html += '<div class="lz-topic-header" onclick="this.parentElement.classList.toggle(\'open\')">';
      html += '<span class="lz-topic-label">' + t.label + '</span>';
      if (count > 0) html += '<span class="lz-topic-badge">' + count + ' Fragen</span>';
      html += '<span class="lz-topic-chevron">â–¶</span>';
      html += '</div><div class="lz-topic-body"><ul class="lz-list">';
      t.lernziele.forEach(function(lz) { html += '<li>' + formatLZ(lz) + '</li>'; });
      html += '</ul></div></div>';
    });
    html += '</div>';
  }
  body.innerHTML = html;
  document.getElementById('lzOverlay').classList.add('active');
}

function closeLzModal() {
  document.getElementById('lzOverlay').classList.remove('active');
}

function formatLZ(text) {
  var match = text.match(/\((K[1-6])\)\s*$/);
  if (match) {
    return text.replace(/\s*\(K[1-6]\)\s*$/, '') + ' <span class="lz-tax">' + match[1] + '</span>';
  }
  return text;
}

document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') closeLzModal();
});

// ğŸ Alle Lernziele im Header-Button
async function openAllLernziele() {
  // Alle Pool-Configs laden (aus Cache oder frisch)
  var allData = [];
  for (var i = 0; i < POOLS.length; i++) {
    var p = POOLS[i];
    if (!lzCache[p.id]) {
      try {
        var resp = await fetch('config/' + p.id + '.js', {cache: 'no-cache'});
        var code = await resp.text();
        var w = {};
        var fn = new Function('window', code + '; return {POOL_META: window.POOL_META, TOPICS: window.TOPICS, QUESTIONS: window.QUESTIONS};');
        var data = fn(w);
        var hasLZ = false;
        if (data.POOL_META && data.POOL_META.lernziele && data.POOL_META.lernziele.length > 0) hasLZ = true;
        if (!hasLZ && data.TOPICS) {
          var keys = Object.keys(data.TOPICS);
          for (var k = 0; k < keys.length; k++) {
            var t = data.TOPICS[keys[k]];
            if (t && t.lernziele && t.lernziele.length > 0) { hasLZ = true; break; }
          }
        }
        lzCache[p.id] = { data: data, hasLZ: hasLZ };
      } catch(e) { continue; }
    }
    if (lzCache[p.id] && lzCache[p.id].hasLZ) {
      allData.push({ title: p.title, fach: p.fach, data: lzCache[p.id].data });
    }
  }
  if (allData.length === 0) return;
  // Modal mit allen Lernzielen aufbauen
  document.getElementById('lzModalTitle').innerHTML = 'ğŸ Alle Lernziele';
  var body = document.getElementById('lzModalBody');
  var html = '';
  FACH_ORDER.forEach(function(fach) {
    var fachPools = allData.filter(function(d) { return d.fach === fach; });
    if (fachPools.length === 0) return;
    html += '<div class="lz-pool-section"><h3>' + fach + '</h3>';
    fachPools.forEach(function(pool) {
      html += '<div style="margin-bottom:16px">';
      html += '<div style="font-weight:700;font-size:.92rem;margin-bottom:8px">' + pool.title + '</div>';
      if (pool.data.POOL_META.lernziele && pool.data.POOL_META.lernziele.length) {
        html += '<ul class="lz-list" style="margin-bottom:8px">';
        pool.data.POOL_META.lernziele.forEach(function(lz) { html += '<li>' + formatLZ(lz) + '</li>'; });
        html += '</ul>';
      }
      var keys = Object.keys(pool.data.TOPICS);
      var anyTopicLZ = keys.some(function(k) { return pool.data.TOPICS[k].lernziele && pool.data.TOPICS[k].lernziele.length; });
      if (anyTopicLZ) {
        keys.forEach(function(key) {
          var t = pool.data.TOPICS[key];
          if (!t.lernziele || !t.lernziele.length) return;
          var count = pool.data.QUESTIONS ? pool.data.QUESTIONS.filter(function(q) { return q.topic === key; }).length : 0;
          html += '<div class="lz-topic">';
          html += '<div class="lz-topic-header" onclick="this.parentElement.classList.toggle(\'open\')">';
          html += '<span class="lz-topic-label">' + t.label + '</span>';
          if (count > 0) html += '<span class="lz-topic-badge">' + count + ' Fragen</span>';
          html += '<span class="lz-topic-chevron">â–¶</span>';
          html += '</div><div class="lz-topic-body"><ul class="lz-list">';
          t.lernziele.forEach(function(lz) { html += '<li>' + formatLZ(lz) + '</li>'; });
          html += '</ul></div></div>';
        });
      }
      html += '</div>';
    });
    html += '</div>';
  });
  body.innerHTML = html;
  document.getElementById('lzOverlay').classList.add('active');
}

// ğŸ-Buttons nach dem Rendern prÃ¼fen
checkLzButtons();
</script>
</body>
</html>
